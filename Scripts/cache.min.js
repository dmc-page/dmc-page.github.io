!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).cachePolyfill={})}(this,(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var o=new WeakMap,c=function(e){return o.get(e)},u=function(e,t){if(t.length<e)throw new TypeError("".concat(e," argument required, but only ").concat(t.length," present."))},s=function(e){return e&&e instanceof Request};function l(){return new Promise((function(e){var t=indexedDB.open("cachestorage",4);t.onupgradeneeded=function(){var e=t.result;e.createObjectStore("storages",{keyPath:"cacheName"}),e.createObjectStore("caches",{autoIncrement:!0}).createIndex("cacheName","cacheName",{unique:!1})},t.onsuccess=function(){e(t.result)}}))}var h=function(){function e(r){t(this,e),o.set(this,r)}return n(e,[{key:"match",value:async function(){return(await this.matchAll.apply(this,arguments))[0]}},{key:"matchAll",value:async function(e){if("HEAD"===e.method)return[];var t=c(this),r=await l(),n=[],a=r.transaction("caches","readonly");return a.objectStore("caches").index("cacheName").openCursor(IDBKeyRange.only(t)).onsuccess=function(){var t=this.result;if(t){if((e.url||e)===t.value.reqUrl){var r=Object.assign({url:t.value.resUrl},t.value),a=new Response(t.value.body,r);n.push(a)}t.continue()}},new Promise((function(e){return a.oncomplete=function(){return e(n)}}))}},{key:"add",value:async function(e){return u(1,arguments),this.addAll([e])}},{key:"addAll",value:async function(e){var t=this;u(1,arguments);var r=[],n=!0,o=!1,c=void 0;try{for(var i,s=async function(){var e=i.value;if(e=new Request(e),!/^((http|https):\/\/)/.test(e.url))throw new TypeError('Add/AddAll does not support schemes other than "http" or "https"');if("GET"!==e.method)throw new TypeError("Add/AddAll only supports the GET request method");e.clone();await fetch(e).then((function(t){if(206===t.status)throw new TypeError("Partial response (status code 206) is unsupported");if(!t.ok)throw new TypeError("Request failed");r.push([e,t])}))},l=e[Symbol.iterator]();!(n=(i=l.next()).done);n=!0)await s()}catch(e){o=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(o)throw c}}await Promise.all(r.map((function(e){return t.put.apply(t,a(e))})))}},{key:"put",value:async function(e,t){if(u(2,arguments),e=s(e)?e:new Request(e),await this.delete(e),!/^((http|https):\/\/)/.test(e.url))throw new TypeError("Request scheme '".concat(e.url.split(":")[0],"' is unsupported"));if("GET"!==e.method)throw new TypeError("Request method '".concat(e.method,"' is unsupported"));if(206===t.status)throw new TypeError("Partial response (status code 206) is unsupported");var r=t.headers.get("Vary");if(r&&r.includes("*"))throw new TypeError("Vary header contains *");if(null!=t.body&&t.bodyUsed)throw new TypeError("Response body is already used");var n=c(this),o={cacheName:n,headers:a(t.headers),status:t.status,statusText:t.statusText,body:await t.arrayBuffer(),reqUrl:e.url.replace(/#.*$/,""),resUrl:t.url.replace(/#.*$/,""),reqMethod:e.method},i=await l();await new Promise((function(e,t){var r=i.transaction("caches","readwrite");r.objectStore("caches").put(o),r.oncomplete=function(){return e()},r.onerror=function(){return t(transaction.error)}}))}},{key:"delete",value:async function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u(1,arguments);var r=c(this),n=t.ignoreMethod,a=s(e)?e:new Request(e);if(!["GET","HEAD"].includes(a.method)&&n)return!1;var o=a.method,i=a.url.replace(/#.*$/,""),h=await l(),f=h.transaction("caches","readwrite"),d=f.objectStore("caches"),y=d.index("cacheName"),p=y.openCursor(IDBKeyRange.only(r)),w=!1;return p.onsuccess=function(){var e=this.result;e&&(i!==e.value.reqUrl||!n&&o!==e.value.reqMethod||(w=!0,d.delete(e.primaryKey)),e.continue())},new Promise((function(e){return f.oncomplete=function(){return e(w)}}))}},{key:"keys",value:async function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=c(this),a=r.ignoreMethod,o=void 0!==a&&a,u=r.ignoreSearch,i=void 0!==u&&u;if(void 0!==e&&(e=new Request(e),t=e.url.split("#")[0],"GET"!==e.method&&!o))return[];var s=void 0===e?function(e){return e}:function(e){return e.filter((function(e){return i?(e=e.reqUrl.split("?")[0],t=t.split("?")[0]):e=e.reqUrl,e===t}))},h=await l(),f=await new Promise((function(e){var t=h.transaction("caches","readonly").objectStore("caches").index("cacheName").getAll(IDBKeyRange.only(n));t.onsuccess=function(){return e(t.result)}}));return s(f).map((function(e){return new Request(e.reqUrl)}))}}]),e}();function f(){return new Promise((function(e){var t=indexedDB.open("cachestorage",4);t.onupgradeneeded=function(){var e=t.result;e.createObjectStore("storages",{keyPath:"cacheName"});e.createObjectStore("caches",{autoIncrement:!0}).createIndex("cacheName","cacheName",{unique:!1})},t.onsuccess=function(){e(t.result)}}))}var d=function(){function e(){t(this,e)}return n(e,[{key:"delete",value:async function(e){if(!(await this.keys()).includes(e))return!1;var t=(await f()).transaction(["storages","caches"],"readwrite");t.objectStore("storages").delete(e);var r=t.objectStore("caches");return r.index("cacheName").getAllKeys(IDBKeyRange.only(e)).onsuccess=function(e){var t=!0,n=!1,a=void 0;try{for(var o,c=this.result[Symbol.iterator]();!(t=(o=c.next()).done);t=!0){var u=o.value;r.delete(u)}}catch(e){n=!0,a=e}finally{try{t||null==c.return||c.return()}finally{if(n)throw a}}},new Promise((function(e,r){t.oncomplete=function(){return e(!0)},t.onerror=function(){return r(!1)}}))}},{key:"has",value:function(e){return this.keys().then((function(t){return t.includes(e)}))}},{key:"keys",value:async function(){var e=(await f()).transaction("storages","readonly").objectStore("storages").getAllKeys();return new Promise((function(t){return e.onsuccess=function(){return t(e.result)}}))}},{key:"match",value:async function(){var e=await this.keys(),t=!0,r=!1,n=void 0;try{for(var a,o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var c=a.value,u=await this.open(c),i=await u.match.apply(u,arguments);if(i)return i}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"open",value:async function(e){if(arguments.length<1)throw new TypeError("".concat(i," argument required, but only ").concat(arguments.length," present."));var t=await f();return await new Promise((function(r,n){var a=t.transaction("storages","readwrite");a.objectStore("storages").put({cacheName:e}),a.oncomplete=function(){return r()},a.onerror=function(){return n(transaction.error)}})),new h(e)}},{key:Symbol.toStringTag,value:function(){return"CacheStorage"}}]),e}(),y={Cache:h,CacheStorage:d,caches:new d},p=y.Cache,w=y.CacheStorage,v=y.caches;e.Cache=p,e.CacheStorage=w,e.__moduleExports=y,e.caches=v,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=cache.min.js.map
